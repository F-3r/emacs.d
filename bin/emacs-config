#!/bin/bash
EMACS_DIR=~/.emacs.d
EMACS_OLD=~/.emacs.d.old
DIR=$(cd $(dirname "$0"); pwd)
EMACS_NEW=${DIR%/bin}


link_new_config() {
  echo "configuring emacs..."
  if [ -d $EMACS_DIR ]; then
    if [ -d $EMACS_OLD ]; then
      echo "Old configuration already backed up in $EMACS_OLD"
    else
      echo "backing up old configuration in $EMACS_OLD..."
      mv $EMACS_DIR $EMACS_OLD
    fi
  fi

  echo "symlinking new config..."
  rm -rf $EMACS_DIR
  ln -s "$EMACS_NEW" "$EMACS_DIR"

  echo -e "done!\n\n"
}

restore_old_config() {
  if [ ! -d $EMACS_OLD ]; then
    echo "There's no previous configuration!"

    exit 1
  else
    rm $EMACS_DIR
    mv $EMACS_OLD $EMACS_DIR

    echo -e "done!\n\n"
  fi
}

case $1 in
  install)
    link_new_config
  ;;

  restore)
    restore_old_config
  ;;

  *)
    echo "
Usage:   emacs-config { install | restore }
  
  - install: backs up current ~/emacs.d and make ~/.emacs.d a symlink pointing to this configuration.
  - restore: Restores the previous ./emacs.d backup copy
"
  ;;
esac
